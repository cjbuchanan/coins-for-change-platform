# Default values for coins-for-change
# This is a YAML-formatted file.

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Application image configuration
image:
  registry: docker.io
  repository: coins-for-change
  tag: "latest"
  pullPolicy: IfNotPresent
  pullSecrets: []

# Application configuration
app:
  name: coins-for-change
  environment: development
  debug: true
  logLevel: DEBUG

# Deployment configuration
replicaCount: 2

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 8000
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations:
    {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: coins-for-change.local
      paths:
        - path: /
          pathType: Prefix
  tls:
    []
    # - secretName: coins-for-change-tls
    #   hosts:
    #     - coins-for-change.local

# Resource configuration
resources:
  requests:
    memory: 256Mi
    cpu: 250m
  limits:
    memory: 512Mi
    cpu: 500m

# Autoscaling configuration
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Health check configuration
healthCheck:
  enabled: true
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /ready
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  startupProbe:
    httpGet:
      path: /startup
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30

# Security configuration
podSecurityContext:
  enabled: true
  fsGroup: 1000

securityContext:
  enabled: true
  runAsNonRoot: true
  runAsUser: 1000
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Node selection
nodeSelector: {}
tolerations: []
affinity: {}

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Database configuration
database:
  # Connection settings
  poolSize: 20
  maxOverflow: 50
  poolTimeout: 30

  # External database (if not using built-in PostgreSQL)
  external:
    enabled: false
    host: ""
    port: 5432
    database: coins_for_change
    username: postgres
    password: ""
    existingSecret: ""
    existingSecretPasswordKey: ""

# Redis configuration (for caching)
redis:
  enabled: true
  auth:
    enabled: false
  master:
    resources:
      requests:
        memory: 128Mi
        cpu: 100m
      limits:
        memory: 256Mi
        cpu: 200m
    persistence:
      enabled: false
  replica:
    replicaCount: 0

# PostgreSQL configuration (Bitnami subchart)
postgresql:
  enabled: true
  auth:
    enablePostgresUser: true
    database: coins_for_change
    username: postgres
    # Password will be auto-generated
  primary:
    resources:
      requests:
        memory: 256Mi
        cpu: 250m
      limits:
        memory: 512Mi
        cpu: 500m
    persistence:
      enabled: true
      size: 5Gi
    podSecurityContext:
      enabled: true
      fsGroup: 1001
    containerSecurityContext:
      enabled: true
      runAsUser: 1001
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: false
      capabilities:
        drop:
          - ALL
  metrics:
    enabled: true
    resources:
      requests:
        memory: 64Mi
        cpu: 50m
      limits:
        memory: 128Mi
        cpu: 100m

# Application secrets
secrets:
  # JWT configuration
  jwtSecretKey: "your-secret-key-change-in-production-12345"

  # External service credentials
  smtp:
    host: ""
    port: 587
    username: ""
    password: ""
    useTls: true

# Configuration maps
config:
  # CORS settings
  corsOrigins: "http://localhost:3000,http://localhost:8080"

  # Rate limiting
  rateLimitPerMinute: 60
  rateLimitPerHour: 1000

  # Observability
  otelServiceName: coins-for-change
  prometheusMetricsPort: 9090

# Migration job configuration
migration:
  enabled: true
  image:
    repository: coins-for-change
    tag: "latest"
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m
  backoffLimit: 3
  restartPolicy: OnFailure

# Monitoring and observability
monitoring:
  # Prometheus metrics
  metrics:
    enabled: true
    port: 9090
    path: /metrics
    serviceMonitor:
      enabled: false
      interval: 30s
      scrapeTimeout: 10s

  # Jaeger tracing
  tracing:
    enabled: false
    jaegerEndpoint: ""

# Network policies
networkPolicy:
  enabled: false
  ingress:
    enabled: true
    from: []
  egress:
    enabled: true
    to: []
